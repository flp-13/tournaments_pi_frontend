import{d as z,o as m,l as M,m as $,f as c,t as F,s as W,q as N,y as X,z as ae,_ as re,a as T,e as O,c as k,F as j,G as q,u as o,j as G,h as L,w as Z,g as ee,I as te,J as ie,i as A,B as se,C as oe,A as ue,r as de,D,K as ce}from"./index.f460c7b2.js";import{l as le}from"./lodash.dd9bff61.js";const pe=N(" Declare Winner "),me={flex:"","gap-5":"","items-center":"","text-center":"","my-4":""},he={class:"w-48%"},ve={class:"text-xl"},ye=c("div",{"i-carbon-trophy":""},null,-1),ge=c("div",{class:"w-4% text-3xl"}," VS ",-1),fe={class:"w-48%"},_e={class:"text-xl"},ke=c("div",{"i-carbon-trophy":""},null,-1),be=z({props:{selected:null},emits:["close","declareWinner"],setup(a,{emit:s}){const e=a;function l(){s("close")}function r(t){t&&e.selected&&s("declareWinner",e.selected,t)}return(t,u)=>{const b=X,g=ae;return m(),M(g,{show:!!a.selected,onClose:l},{title:$(()=>[pe]),default:$(()=>{var n,d,v,_,w,p;return[c("div",me,[c("div",he,[c("div",ve,F((v=(d=(n=a.selected)==null?void 0:n.prev_match)==null?void 0:d.left.player)==null?void 0:v.name),1),W(b,{class:"btn btn-theme-warning text-2xl mt-3",onClick:u[0]||(u[0]=P=>{var C,E,U;return r((U=(E=(C=a.selected)==null?void 0:C.prev_match)==null?void 0:E.left)!=null?U:null)})},{default:$(()=>[ye]),_:1})]),ge,c("div",fe,[c("div",_e,F((p=(w=(_=a.selected)==null?void 0:_.prev_match)==null?void 0:w.right.player)==null?void 0:p.name),1),W(b,{class:"btn btn-theme-warning text-2xl mt-3",onClick:u[1]||(u[1]=P=>{var C,E,U;return r((U=(E=(C=a.selected)==null?void 0:C.prev_match)==null?void 0:E.right)!=null?U:null)})},{default:$(()=>[ke]),_:1})])])]}),_:1},8,["show"])}}});const $e=["id","name","value"],xe=["value"],we=z({props:{modelValue:null,label:null,name:null,id:null,invalidFeedback:null,placeholder:null,style:null,options:null},emits:["update:modelValue"],setup(a){const s=a,e=T(!1),l=O(()=>s.placeholder?[{value:null,label:s.placeholder},...s.options]:s.options);return(r,t)=>(m(),k("div",{class:"input-group-wrapper",style:L(a.style)},[c("div",{class:G(["input-group",{[e.value?"focused":"blurred"]:!0}])},[c("select",{id:a.id,name:a.name,value:a.modelValue,"bg-transparent":"",onFocusin:t[0]||(t[0]=u=>e.value=!0),onFocusout:t[1]||(t[1]=u=>e.value=!1),onChange:t[2]||(t[2]=u=>r.$emit("update:modelValue",u.target.value))},[(m(!0),k(j,null,q(o(l),u=>{var b;return m(),k("option",{key:(b=u.value)!=null?b:"placeholder","text-1rem":"",value:u.value},F(u.label),9,xe)}),128))],40,$e)],2)],4))}});var Pe=re(we,[["__scopeId","data-v-3d9a6703"]]);const Be={flex:"","flex-col":""},We=["id","value"],Ce=["for"],Se=["id","value"],Fe=["for"],Ve=N(" Edit Bracket "),Re=z({props:{selected:null,addedPlayers:null,remainingPlayers:null},emits:["close","fill","switch"],setup(a,{emit:s}){const e=a,l=T("switch-player"),r=T(null),t=T(null);function u(){r.value=t.value=null,s("close")}function b(){if(r.value){const n=e.remainingPlayers.find(d=>d.id===r.value);n&&(s("fill",n),r.value=t.value=null)}else if(t.value){const n=e.addedPlayers.find(d=>d.id===t.value);n&&(s("switch",n),r.value=t.value=null)}}const g=O(()=>e.addedPlayers.filter(n=>{var d,v;return n.id!==((v=(d=e.selected)==null?void 0:d.player)==null?void 0:v.id)}));return Z(()=>l.value,()=>{r.value=t.value=null}),(n,d)=>{const v=Pe,_=X,w=ae;return m(),M(w,{show:!!a.selected,"is-form":"",onClose:u,onSubmit:b},{title:$(()=>{var p;return[N(F((p=a.selected)!=null&&p.player?"Switch":"Fill")+" Bracket With \xA0",1),W(v,{id:"modal-type",modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=P=>l.value=P),name:"modalType",style:{marginTop:0,marginBottom:0},options:[{label:"Switch Player",value:"switch-player"},{label:"Remaining Players",value:"remaining-player"}]},null,8,["modelValue"])]}),footer:$(()=>[W(_,{class:"btn btn-brand-primary",type:"submit"},{default:$(()=>[Ve]),_:1})]),default:$(()=>[c("div",Be,[l.value==="switch-player"?(m(!0),k(j,{key:0},q(o(g),p=>{var P;return m(),k("div",{key:(P=p.id)!=null?P:0,"py-2":"","pl-3":"",flex:"","gap-3":"",class:G({"dark:bg-dark-300 bg-light-800":t.value===p.id})},[ee(c("input",{id:`added-modal-${p.id}`,"onUpdate:modelValue":d[1]||(d[1]=C=>t.value=C),type:"radio",name:"addedPlayerModal",value:p.id},null,8,We),[[te,t.value]]),c("label",{for:`added-modal-${p.id}`},F(p.name),9,Ce)],2)}),128)):(m(!0),k(j,{key:1},q(a.remainingPlayers,p=>{var P;return m(),k("div",{key:(P=p.id)!=null?P:0,"py-2":"","pl-3":"",flex:"","gap-3":"",class:G({"dark:bg-dark-300 bg-light-800":r.value===p.id})},[ee(c("input",{id:`remaining-modal-${p.id}`,"onUpdate:modelValue":d[2]||(d[2]=C=>r.value=C),type:"radio",name:"remainingPlayerModal",value:p.id},null,8,Se),[[te,r.value]]),c("label",{for:`remaining-modal-${p.id}`},F(p.name),9,Fe)],2)}),128))])]),_:1},8,["show"])}}}),Te=c("h2",null,"Remaining Players",-1),De={flex:"","flex-col":""},Me=["id","value"],ze=["for"],Ne={flex:"","gap-3":""},je=N(" Cancel "),Ee=N(" Randomize "),Ue=z({props:{players:null,selected:null},emits:["changedSelection","randomizePlayers"],setup(a,{emit:s}){const e=a,l=T(e.selected);return Z(()=>l.value,()=>{s("changedSelection",l.value)}),Z(()=>e.selected,()=>{l.value=e.selected}),(r,t)=>{const u=X,b=ie;return m(),M(b,{"w-75":""},{title:$(()=>[Te]),footer:$(()=>[c("div",Ne,[W(u,{class:"btn btn-theme-danger",disabled:!l.value,onClick:t[1]||(t[1]=g=>l.value=null)},{default:$(()=>[je]),_:1},8,["disabled"]),W(u,{class:"btn btn-theme-warning",onClick:t[2]||(t[2]=g=>r.$emit("randomizePlayers"))},{default:$(()=>[Ee]),_:1})])]),default:$(()=>[c("div",De,[(m(!0),k(j,null,q(a.players,g=>{var n,d;return m(),k("div",{key:(n=g.id)!=null?n:0,"py-2":"","pl-3":"",flex:"","gap-3":"",class:G({"dark:bg-dark-300 bg-light-800":((d=l.value)==null?void 0:d.id)===g.id})},[ee(c("input",{id:`remaining-${g.id}`,"onUpdate:modelValue":t[0]||(t[0]=v=>l.value=v),type:"radio",name:"remainingPlayer",value:g},null,8,Me),[[te,l.value]]),c("label",{for:`remaining-${g.id}`},F(g.name),9,ze)],2)}),128))])]),_:1})}}}),He=["height","viewBox"],Oe=["d"],Ae=["height","viewBox"],Le=["transform","d"],qe=z({props:{height:null,direction:null},setup(a){const s=a,e=O(()=>s.height/2),l=O(()=>{const r={right:"-40px"};return r[s.direction==="down"?"top":"bottom"]=`${s.height-5}px`,r});return(r,t)=>(m(),k("div",{absolute:"",style:L(o(l))},[a.direction==="down"?(m(),k("svg",{key:0,width:"40",height:o(e)*2,viewBox:`0 0 40 ${o(e)*2}`,fill:"none",xmlns:"http://www.w3.org/2000/svg","dark:stroke-white":"","stroke-gray":""},[c("path",{d:`
          M 0 0
          c 20 0 20 ${o(e)} 20 ${o(e)}
          c 0 ${o(e)} 20 ${o(e)} 20 ${o(e)}`,"stroke-width":"2"},null,8,Oe)],8,He)):(m(),k("svg",{key:1,height:o(e)*2,viewBox:`0 0 40 ${o(e)*2}`,fill:"none",xmlns:"http://www.w3.org/2000/svg","dark:stroke-white":"","stroke-gray":"","stroke-width":"2"},[c("path",{transform:`scale(1, -1) translate(0, -${o(e)*2})`,d:`
          M 0 0
          c 20 0 20 ${o(e)} 20 ${o(e)}
          c 0 ${o(e)} 20 ${o(e)} 20 ${o(e)}`},null,8,Le)],8,Ae))],4))}}),Ge=z({props:{bracket:null,isLastRound:{type:Boolean},inputingPlayer:null,tournamentStarted:{type:Boolean}},emits:["placedPlayer","fillWithPlayer","declareWinner"],setup(a,{emit:s}){const e=a,l=T(!1);function r(){var n,d,v,_,w,p;if(e.inputingPlayer&&((n=e.bracket)==null?void 0:n.match)===null){l.value=!0,s("placedPlayer",e.inputingPlayer,e.bracket.id,()=>{l.value=!1});return}((d=e.bracket)==null?void 0:d.match)===null&&u(),((v=e.bracket)==null?void 0:v.match)&&((_=e.bracket)==null?void 0:_.match)>0&&!e.bracket.player_id&&e.tournamentStarted&&((w=e.bracket.prev_match)==null?void 0:w.left.player_id)&&((p=e.bracket.prev_match)==null?void 0:p.right.player_id)&&t()}function t(){s("declareWinner",e.bracket)}function u(){s("fillWithPlayer",e.bracket)}const b=O(()=>({visibility:e.bracket===null?"hidden":"visible",pointerEvents:e.bracket===null?"none":"auto"})),g=O(()=>{var _,w,p,P;const n="dark:bg-dark-400 bg-gray-500",d="hover:dark:bg-dark-200 hover:bg-gray-400 cursor-pointer",v="dark:bg-dark-300 bg-gray-300";return e.tournamentStarted?((_=e.bracket)==null?void 0:_.match)===null?n.split(" "):(w=e.bracket)!=null&&w.player_id?v.split(" "):`${v} ${d}`.split(" "):e.inputingPlayer&&((p=e.bracket)==null?void 0:p.match)===null?`${v} ${d}`.split(" "):((P=e.bracket)==null?void 0:P.match)===null?`${v} ${d}`.split(" "):n.split(" ")});return(n,d)=>{var v,_;return m(),k("div",{class:G(["color-black dark:color-white flex items-center px-3 transition",o(g)]),style:L(o(b)),onClick:r},[c("span",null,F((_=(v=a.bracket)==null?void 0:v.player)==null?void 0:_.name),1)],6)}}}),Ie=z({props:{round:null,roundNum:null,inputingPlayer:null,tournamentStarted:{type:Boolean}},emits:["placedPlayer","fillWithPlayer","declareWinner"],setup(a){function r(t){return t<=0?40:r(t-1)*2+10}return(t,u)=>{const b=Ge,g=qe;return m(),k("div",{flex:"","flex-col":"",style:L({gap:`${10}px`})},[(m(!0),k(j,null,q(a.round,(n,d)=>{var v;return m(),k("div",{key:(v=n==null?void 0:n.id)!=null?v:d,grid:"","place-items-center":"",style:L({height:`${r(a.roundNum)}px`}),relative:""},[W(b,{"tournament-started":a.tournamentStarted,"inputing-player":a.inputingPlayer,style:L({height:`${40}px`,width:`${225}px`}),bracket:n,"is-last-round":a.round.length===1,onPlacedPlayer:u[0]||(u[0]=(_,w,p)=>t.$emit("placedPlayer",_,w,p)),onFillWithPlayer:_=>t.$emit("fillWithPlayer",_),onDeclareWinner:_=>t.$emit("declareWinner",_)},null,8,["tournament-started","inputing-player","style","bracket","is-last-round","onFillWithPlayer","onDeclareWinner"]),n!==null&&a.round.length>1?(m(),M(g,{key:0,height:r(a.roundNum)/2+10/2,direction:d%2===0?"down":"up"},null,8,["height","direction"])):A("",!0)],4)}),128))],4)}}}),Je={flex:"","gap-40px":"","overflow-auto":""},Ke=z({props:{rounds:null,inputingPlayer:null,tournamentStarted:{type:Boolean}},emits:["placedPlayer","fillWithPlayer","declareWinner"],setup(a){return(s,e)=>{const l=Ie;return m(),k("div",Je,[(m(!0),k(j,null,q(a.rounds,(r,t)=>(m(),M(l,{key:t,"inputing-player":a.inputingPlayer,round:r,"round-num":+t,"tournament-started":a.tournamentStarted,onPlacedPlayer:e[0]||(e[0]=(u,b,g)=>s.$emit("placedPlayer",u,b,g)),onFillWithPlayer:e[1]||(e[1]=u=>s.$emit("fillWithPlayer",u)),onDeclareWinner:e[2]||(e[2]=u=>s.$emit("declareWinner",u))},null,8,["inputing-player","round","round-num","tournament-started"]))),128))])}}});function K(a,s,e="id"){let l=[a],r=[];for(;l.length>0;){const t=l[0];if(t[e]===s)return t;t&&t.prev_match&&(t.prev_match.left&&r.push(t.prev_match.left),t.prev_match.right&&r.push(t.prev_match.right)),l.shift(),l.length===0&&r.length>0&&(l=[...r],r=[])}return null}const Qe={container:"","mx-auto":"","px-4":""},Xe={class:"flex items-center text-2xl gap-2"},Ye=c("hr",{class:"my-4"},null,-1),Ze={class:"flex"},et=N(" Configure Players "),tt=c("div",{"i-carbon-user-multiple":""},null,-1),nt={class:"flex gap-5 ml-auto"},lt={flex:"","gap-3":"","mt-5":""},it=z({props:{tournament:null},setup(a){const s=a,e=se(),l=T(null),r=T(null),t=T(null),u=T(null),b=oe(),g=ue(),n=de({brackets:null,added_players:[],remaining_players:[],total_players:0,total_rounds:0});D.get(`/tournaments/${s.tournament}`).then(i=>{l.value=i.data,D.get(`/tournaments/${s.tournament}/brackets`).then(y=>{if(y.status===204){n.brackets={};return}Object.assign(n,y.data)})});function d(){D.put(`/tournaments/${s.tournament}/brackets?empty=true`).then(i=>{if(i.status===204){b.warning("Brackets are empty. Please add some players.");return}Object.assign(n,i.data)})}function v(){D.put(`/tournaments/${s.tournament}/brackets`).then(i=>{Object.assign(n,i.data)})}function _(i,y,h){D.put(`/brackets/${y}/player`,{player_id:i.id}).then(()=>{var x,B;const f=K(n.brackets,y);f&&(f.player_id=i.id,f.player=i),n.remaining_players=(x=n.remaining_players)==null?void 0:x.filter(S=>S.id!==i.id),(B=n.added_players)==null||B.push(i),r.value=null,h()})}function w(i){t.value=i}function p(i){t.value&&D.put(`/brackets/${t.value.id}/player`,{player_id:i.id}).then(y=>{var f,x,B;const h=K((f=n.brackets)!=null?f:{},t.value.id);h&&(h.player=i,h.player_id=i.id,t.value=null,(x=n.added_players)==null||x.push(i),n.remaining_players=(B=n.remaining_players)==null?void 0:B.filter(S=>S.id!==i.id))})}function P(i){t.value&&D.put(`/brackets/${t.value.id}/player`,{player_id:i.id}).then(y=>{var x,B,S,H;const h=K((x=n.brackets)!=null?x:{},t.value.id),f=K((B=n.brackets)!=null?B:{},i.id,"player_id");h&&f&&(h.player_id=f.player_id,h.player=f.player,f.player_id=(S=t.value)==null?void 0:S.player_id,f.player=(H=t.value)==null?void 0:H.player,t.value=null)})}function C(){l.value&&D.put(`/tournaments/${l.value.id}/start`).then(()=>{l.value.started=!0}).catch(i=>{b.error(i.response.data.message,{timeout:6e3})})}function E(i){u.value=i}function U(i,y){D.put(`tournaments/${s.tournament}/matches/${i.match}/winner`,{player_id:y.player_id}).then(h=>{var x;const f=K((x=n.brackets)!=null?x:{},i.id);f&&(f.player_id=y.player_id,f.player=y.player,u.value=null)})}const Y=O(()=>{var x,B,S,H,I,J,V,ne;if(!n.brackets||le.exports.isEmpty(n.brackets))return[];let i=[n.brackets],y=[];const h=[[]];let f=0;for(;i.length>0;){const R=le.exports.cloneDeep(i[0]);R?(y.push((B=(x=R.prev_match)==null?void 0:x.left)!=null?B:null,(H=(S=R.prev_match)==null?void 0:S.right)!=null?H:null),h[f].push(R)):h[f].push(null),i.shift(),i.length===0&&y.length>0&&(f++,h.push([]),i=[...y],y=[])}h.pop();for(let R=0;R<h.length;R++)for(let Q=0;Q<h[R].length;Q++)(J=(I=h[R][Q])==null?void 0:I.prev_match)==null||delete J.left.prev_match,(ne=(V=h[R][Q])==null?void 0:V.prev_match)==null||delete ne.right.prev_match;return h.reverse(),h});return(i,y)=>{var I,J;const h=X,f=ce("router-link"),x=Ke,B=Ue,S=Re,H=be;return m(),k(j,null,[c("div",Qe,[l.value?(m(),k(j,{key:0},[c("div",Xe,[c("button",{"i-carbon-caret-left":"",onClick:y[0]||(y[0]=V=>o(e).back())}),c("h1",null,F(l.value.name),1)]),Ye,c("div",Ze,[!l.value.started&&l.value.user_id===o(g).id?(m(),M(f,{key:0,class:"mr-auto",to:`/tournaments/${l.value.id}/players`},{default:$(()=>[W(h,{class:"btn btn-brand-primary md:block hidden"},{default:$(()=>[et]),_:1}),W(h,{class:"btn btn-brand-primary md:hidden block h-3rem w-3rem"},{default:$(()=>[tt]),_:1})]),_:1},8,["to"])):A("",!0),c("div",nt,[o(n).brackets!==null&&!l.value.started&&l.value.user_id===o(g).id?(m(),M(h,{key:0,class:"btn",onClick:d},{default:$(()=>[N(F(o(Y).length>0?"Recreate":"Create")+" Brackets ",1)]),_:1})):A("",!0),W(h,{class:G([{"pointer-events-none":l.value.user_id!==o(g).id||l.value.started},"btn btn-theme-warning"]),onClick:C},{default:$(()=>{var V;return[N(F(l.value.started?(V=o(n).brackets)!=null&&V.player_id?"Tournament Finished":"Tournament Started":"Start Tournament"),1)]}),_:1},8,["class"])])]),c("div",lt,[o(Y).length>0?(m(),M(x,{key:0,"mt-10":"",rounds:o(Y),"flex-grow":"","inputing-player":r.value,"tournament-started":!!l.value.started,onPlacedPlayer:_,onFillWithPlayer:w,onDeclareWinner:E},null,8,["rounds","inputing-player","tournament-started"])):A("",!0),!l.value.started&&o(n).remaining_players&&o(n).remaining_players.length>0?(m(),M(B,{key:1,players:o(n).remaining_players,selected:r.value,onRandomizePlayers:v,onChangedSelection:y[1]||(y[1]=V=>r.value=V)},null,8,["players","selected"])):A("",!0)])],64)):A("",!0)]),W(S,{selected:t.value,"added-players":(I=o(n).added_players)!=null?I:[],"remaining-players":(J=o(n).remaining_players)!=null?J:[],onClose:y[2]||(y[2]=V=>t.value=null),onFill:p,onSwitch:P},null,8,["selected","added-players","remaining-players"]),W(H,{selected:u.value,onClose:y[3]||(y[3]=V=>u.value=null),onDeclareWinner:U},null,8,["selected"])],64)}}});export{it as default};
